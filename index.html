<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>E-Watch — PO Status</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--bd:#e5e7eb;--tx:#0f172a;--mut:#64748b;--hi:#059669;--bg:#ffffff;--pill:#f1f5f9;--ok:#ecfdf5;--bad:#fff1f2}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--tx)}
    .wrap{max-width:1120px;margin:0 auto;padding:16px}
    header{position:sticky;top:0;z-index:10;background:#fffdd;backdrop-filter:saturate(180%) blur(6px);background:#fff;border-bottom:1px solid var(--bd)}
    .hdr{display:flex;align-items:center;gap:12px;padding:12px 16px}
    .logo{width:36px;height:36px;border-radius:999px;background:var(--hi);color:#fff;display:grid;place-items:center;font-weight:700}
    .grid{display:grid;grid-template-columns:1fr;gap:24px;margin-top:20px}
    @media(min-width:960px){.grid{grid-template-columns:280px 1fr}}
    .card{border:1px solid var(--bd);border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,.03);background:#fff}
    .pad{padding:16px}
    .title{font-size:18px;font-weight:700;margin:0}
    .mut{font-size:12px;color:var(--mut)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .input,.select,button{font-size:14px;border:1px solid var(--bd);border-radius:12px;padding:8px 10px;background:#fff}
    .btn{cursor:pointer} .btn:hover{background:#f8fafc}
    .list{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:640px){.list{grid-template-columns:repeat(2,1fr)}}
    @media(min-width:1200px){.list{grid-template-columns:repeat(3,1fr)}}
    .po{transition:box-shadow .2s ease} .po:hover{box-shadow:0 4px 16px rgba(0,0,0,.08)}
    .pill{display:inline-block;background:var(--pill);padding:2px 8px;border-radius:999px;font-size:12px;color:#065f46}
    .kv{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:8px}
    .box{border:1px solid var(--bd);border-radius:12px;padding:10px;background:#f8fafc}
    .ok{background:var(--ok)} .bad{background:var(--bad)}
    footer{border-top:1px solid var(--bd);margin-top:24px}
    .ctr{text-align:center;color:var(--mut);padding:24px}
  </style>
</head>
<body>
  <header>
    <div class="wrap hdr">
      <div class="logo">E</div>
      <div>
        <div class="title">E-Watch — PO Status</div>
        <div class="mut">Live priority board</div>
      </div>
    </div>
  </header>

  <main class="wrap grid">
    <!-- Sidebar / Filters -->
    <aside class="card pad">
      <h3 style="margin-top:0;margin-bottom:12px;font-size:16px">Filters</h3>
      <div class="row" style="margin-bottom:8px">
        <input id="q" class="input" placeholder="Search PO / SO / Customer" style="width:100%">
      </div>
      <div class="row" style="margin-bottom:8px">
        <select id="customer" class="select" style="flex:1"><option value="">All customers</option></select>
      </div>
      <div class="row" style="margin-bottom:8px">
        <select id="status" class="select" style="flex:1"><option value="">All statuses</option></select>
      </div>
      <div class="row">
        <label class="mut" style="align-self:center">Sort</label>
        <select id="sort" class="select">
          <option value="priority">Priority</option>
          <option value="due">Due soonest</option>
          <option value="cust">Customer A→Z</option>
        </select>
        <button id="reset" class="btn">Reset</button>
      </div>
    </aside>

    <!-- Results -->
    <section>
      <div id="list" class="list"></div>
      <div id="empty" class="ctr" style="display:none">No POs match your filters.</div>
    </section>
  </main>

  <footer>
    <div class="wrap ctr">© <span id="yr"></span> E-Watch. PO Status board.</div>
  </footer>

  <script>
    const $ = s => document.querySelector(s);
    const $$ = s => Array.from(document.querySelectorAll(s));
    const yr = new Date().getFullYear(); $('#yr').textContent = yr;

    const state = { items: [], q:'', customer:'', status:'', sort:'priority' };

    const fmtDate = d => d ? new Date(d).toLocaleDateString() : '';
    const unique = arr => Array.from(new Set(arr.filter(Boolean)));

    function compute(list){
      let out = [...list];
      const q = state.q.toLowerCase().trim();
      if(q){
        out = out.filter(i => [i.PO_No, i.SO_No, i.Customer].join(' ').toLowerCase().includes(q));
      }
      if(state.customer) out = out.filter(i => i.Customer === state.customer);
      if(state.status)   out = out.filter(i => i.POStatus === state.status);

      switch(state.sort){
        case 'priority':
          out.sort((a,b)=>{
            const ad=(a.DaysUntilDue??9999), bd=(b.DaysUntilDue??9999);
            if(ad!==bd) return ad-bd;
            const apr=(b.ForPackOrders??0)+(b.CommittedNotShip??0) - ((a.ForPackOrders??0)+(a.CommittedNotShip??0));
            if(apr!==0) return apr;
            return (a.PO_No||'').localeCompare(b.PO_No||'');
          });
          break;
        case 'due':
          out.sort((a,b)=>(a.DaysUntilDue??9999)-(b.DaysUntilDue??9999)); break;
        case 'cust':
          out.sort((a,b)=>(a.Customer||'').localeCompare(b.Customer||'')); break;
      }
      return out;
    }

    function render(list){
      const wrap = $('#list');
      wrap.innerHTML = '';
      $('#empty').style.display = list.length ? 'none' : 'block';
      list.forEach(i=>{
        const overdue = (i.DaysUntilDue??999) < 0;
        const div = document.createElement('article');
        div.className = 'card po';
        div.innerHTML = `
          <div class="pad">
            <div class="pill">${i.POStatus || 'Open'}</div>
            <h4 style="margin:8px 0 2px;font-size:14px">PO ${i.PO_No}${i.SO_No ? ` • SO ${i.SO_No}` : ''}</h4>
            <div class="mut" style="margin-bottom:6px">${i.Customer || ''}</div>
            <div class="kv">
              <div class="box"><div class="mut" style="font-size:11px">Due Date</div><div style="font-weight:600">${fmtDate(i.DueDate)}</div></div>
              <div class="box ${overdue ? 'bad':'ok'}"><div class="mut" style="font-size:11px">Days Until Due</div><div style="font-weight:600">${i.DaysUntilDue ?? ''}</div></div>
              <div class="box"><div class="mut" style="font-size:11px">For Pack</div><div style="font-weight:600">${i.ForPackOrders ?? 0}</div></div>
              <div class="box"><div class="mut" style="font-size:11px">Committed Not Ship</div><div style="font-weight:600">${i.CommittedNotShip ?? 0}</div></div>
              <div class="box"><div class="mut" style="font-size:11px">Shipped / Total</div><div style="font-weight:600">${i.ShipCount ?? 0} / ${i.TotalOrders ?? 0}</div></div>
              <div class="box"><div class="mut" style="font-size:11px">In Transit</div><div style="font-weight:600">${i.InTransit ?? 0}</div></div>
            </div>
          </div>`;
        wrap.appendChild(div);
      });
    }

    function hydrateFilters(items){
      const cust = $('#customer'); const stat = $('#status');
      unique(items.map(i=>i.Customer)).sort().forEach(c=>{
        const o=document.createElement('option'); o.value=c; o.textContent=c; cust.appendChild(o);
      });
      unique(items.map(i=>i.POStatus)).sort().forEach(s=>{
        const o=document.createElement('option'); o.value=s; o.textContent=s; stat.appendChild(o);
      });
    }

    // Wire UI
    $('#q').addEventListener('input', e=>{ state.q=e.target.value; render(compute(state.items)); });
    $('#customer').addEventListener('change', e=>{ state.customer=e.target.value; render(compute(state.items)); });
    $('#status').addEventListener('change', e=>{ state.status=e.target.value; render(compute(state.items)); });
    $('#sort').addEventListener('change', e=>{ state.sort=e.target.value; render(compute(state.items)); });
    $('#reset').addEventListener('click', ()=>{
      state.q=''; state.customer=''; state.status=''; state.sort='priority';
      $('#q').value=''; $('#customer').value=''; $('#status').value=''; $('#sort').value='priority';
      render(compute(state.items));
    });

    // Load data
    fetch('po-status.json', {cache:'no-store'})
      .then(r=>r.json())
      .then(data=>{
        state.items = data;
        hydrateFilters(state.items);
        render(compute(state.items));
      })
      .catch(()=>{ $('#empty').style.display='block'; $('#empty').textContent='po-status.json not found.'; });
  </script>
</body>
</html>